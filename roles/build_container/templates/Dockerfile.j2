# Stage 1: Build Honeyd from source
FROM alpine:latest AS builder

# Install build dependencies
RUN apk update && apk add \
    git \
    gcc \
    make \
    libevent-dev \
    libpcap-dev \
    libdnet \
    automake \
    autoconf \
    libtool

# Clone the Honeyd repository
RUN git clone https://github.com/DataSoft/Honeyd.git /tmp/honeyd

# Build Honeyd from source
WORKDIR /tmp/honeyd
RUN autoreconf -i && ./configure && make

# Stage 2: Create the final container
FROM alpine:latest

# Copy the Honeyd executable from the builder stage
COPY --from=builder /tmp/honeyd/honeyd /usr/local/bin/

# Set up the entrypoint script
COPY entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh
ENTRYPOINT ["/entrypoint.sh"]
